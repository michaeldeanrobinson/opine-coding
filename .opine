# Repository Opinions

## Architecture
- Clean Architecture; logic strictly in Domain Services.
- One namespace per file.
- All code projects reside under `src/`.
- Target framework: `net10.0`; `<LangVersion>latest</LangVersion>`; `<Nullable>enable</Nullable>` — set globally in `src/Directory.Build.props`, never per `.csproj`.
- Centralize all package versions in `src/Directory.Packages.props` (`<ManagePackageVersionsCentrally>true</ManagePackageVersionsCentrally>`); no version attributes in individual `.csproj` files.
- `src/` is the exclusive project boundary — no projects, `Directory.Build.props`, or `Directory.Packages.props` exist outside it.
- On solution creation, generate a `.editorconfig` that encodes all active rules from `.opine`. No `.ruleset` files; no `stylecop.json` — `.editorconfig` is the single source of analyzer configuration.

## C# Patterns
- Use Primary Constructors.
- Favor `records` for DTOs.
- Use language keywords for declarations: `string x`, `int y`. Use BCL type names for static member access: `String.IsNullOrEmpty`, `Int32.Parse`.
- Use `""` not `string.Empty`.
- Use `int?` not `Nullable<int>`.
- `readonly` on all eligible fields.
- Expression-bodied: ✅ accessors/properties — ❌ constructors/methods.
- Use collection expressions (`[]`) for all empty and initialized collections — supersedes `Array.Empty<T>()` and `new T[] { }` / `new List<T> { }` syntax.
- Prefer object initializers, null propagation (`?.`), null coalescing (`??`), throw expressions, index (`^`) and range (`..`) operators.

## Naming
- Private instance fields: `_camelCase`. No `m_` prefix.
- Types, methods, properties: `PascalCase`.
- Interfaces: prefix `I`.
- Type parameters: prefix `T`.
- Variables and parameters: `camelCase`.
- Tuple element names: explicit (not inferred), `PascalCase`.
- No type names used as parameter or variable identifiers.
- No `this.` prefix on local calls.

## Formatting
- 4-space indent for `.cs`; 2-space for `.csproj`. Spaces, not tabs.
- CRLF line endings; UTF-8; always insert final newline.
- Open brace on new line for all blocks.
- Always use braces — no braceless control flow.
- Long parameter/argument lists: one parameter per line.
- Never use `var` — always explicit types.

## Usings
- `<ImplicitUsings>enable</ImplicitUsings>` — common `System.*` namespaces are auto-included; do not re-declare them.
- `System` directives first for any explicit usings.
- Usings outside namespace.
- No unnecessary usings.

## Async
- `ValueTask.FromResult` for synchronous interface implementations; `Task.FromResult` only when the caller requires `Task<T>`.
- Forward `CancellationToken` where applicable.
- `ConfigureAwait(false)` not required (ASP.NET Core context).

## Security
- No hardcoded credentials.
- No SQL string concatenation or format string injection — use parameterized queries.
- Always specify `StringComparison` in string comparisons.

## API Defaults
- Use Minimal API structure — no MVC controllers.
- Always register health checks; map `/health` (full) and `/alive` (liveness) by default.
- Do not register `UseStaticFiles()` middleware in API projects — it enables indiscriminate static file serving.
- Serve static assets (e.g. `favicon.svg`) via dedicated `MapGet` endpoints: resolve the path via `IWebHostEnvironment.WebRootPath`, return `Results.File` with an explicit MIME type, and chain `.AllowAnonymous().ExcludeFromDescription().CacheOutput(policy => policy.Expire(...))`.

## Logging
- Use Serilog as the logging provider (`Serilog.AspNetCore`).
- In `Program.cs`, create a bootstrap logger (`WriteTo.Console().CreateBootstrapLogger()`) before the try block so startup failures are captured.
- Replace the bootstrap logger with the full pipeline logger via `builder.Host.UseSerilog(...)` using `ReadFrom.Configuration` and `ReadFrom.Services`.
- Default sink: Console. OpenTelemetry will be added as an additional sink later.

## Documentation
- XML doc comments not required.

## No-Go Zone
- No `try-catch` in application or request-handling code — use Global Exception Middleware.
- Exception: the Serilog startup bootstrap `try/catch/finally` in `Program.cs` is required to capture startup failures and flush the logger.
- No `#region` directives.
- No `var`.
- No `this.` prefix.
- No hardcoded credentials or SQL string building.
- No `UseStaticFiles()` in API projects — serve static assets via dedicated endpoints.
